# Backend API Requirements: Promo Validation for Home Page

## Overview
The frontend has implemented promo duration validation on the home page. When users select a promo code, the system validates that their selected stay duration matches the promo's required minimum nights. This document outlines the required payload structure and validation logic.

## Endpoint: GET `/promos/agent`

### Current Frontend Implementation
The frontend expects the following structure for promo objects returned from the `/promos/agent` endpoint.

### Required Payload Structure

```typescript
interface PromoHomePage {
  id: number;                    // Required: Unique promo identifier
  name: string;                   // Required: Promo name (e.g., "Stay 3 Pay 2")
  code: string;                   // Required: Promo code (e.g., "STAY3PAY2")
  description: string;            // Required: Promo description
  hotel: string[];                // Required: Array of hotel names where promo is available
  total_nights?: number;          // **NEW**: Optional but recommended - Minimum nights required for this promo
}
```

### Sample Response

```json
{
  "status": 200,
  "message": "Success",
  "data": [
    {
      "id": 501,
      "name": "Stay 3 Pay 2",
      "code": "STAY3PAY2",
      "description": "Book 3 nights and pay for only 2 nights. Valid for selected hotels.",
      "hotel": [
        "Sunrise Beach Resort",
        "Ocean View Hotel",
        "Paradise Resort"
      ],
      "total_nights": 3
    },
    {
      "id": 502,
      "name": "Early Bird Discount",
      "code": "EARLYBIRD",
      "description": "Get 20% off when booking 30 days in advance",
      "hotel": [
        "Sunrise Beach Resort",
        "Mountain View Hotel"
      ],
      "total_nights": 2
    },
    {
      "id": 503,
      "name": "Weekend Special",
      "code": "WEEKEND",
      "description": "Special rates for weekend stays",
      "hotel": [
        "City Center Hotel"
      ]
      // Note: total_nights can be omitted if promo has no minimum night requirement
    }
  ]
}
```

## Validation Logic

### How Frontend Validates Promos

1. **User selects check-in and check-out dates** on the home page
2. **Frontend calculates stay duration** (number of nights) from the selected dates
3. **When user opens promo dialog**, frontend:
   - Fetches all available promos from `/promos/agent`
   - For each promo:
     - If `total_nights` is **not provided** or **null/undefined**: Promo is always valid (no restriction)
     - If `total_nights` **is provided**: Promo is only valid if `user_stay_nights === promo.total_nights`
4. **Invalid promos are disabled** and show "Not Valid" button
5. **If user tries to select invalid promo**, they see an error message:
   ```
   "This promo requires X night(s) stay, but you selected Y night(s)."
   ```

### Example Scenarios

#### Scenario 1: Valid Promo Selection
- **Promo**: `{ id: 501, total_nights: 3 }`
- **User Stay**: 3 nights (check-in: 2025-01-15, check-out: 2025-01-18)
- **Result**: ✅ Promo is valid and can be selected

#### Scenario 2: Invalid Promo Selection
- **Promo**: `{ id: 501, total_nights: 3 }`
- **User Stay**: 2 nights (check-in: 2025-01-15, check-out: 2025-01-17)
- **Result**: ❌ Promo is disabled, shows "Not Valid", user cannot select

#### Scenario 3: Promo Without Duration Requirement
- **Promo**: `{ id: 503 }` (no `total_nights` field)
- **User Stay**: Any duration
- **Result**: ✅ Promo is always valid

## Backend Checklist

Please verify the following:

- [ ] **`total_nights` field is included** in the promo response when the promo has a minimum night requirement
- [ ] **`total_nights` is a number** (not a string)
- [ ] **`total_nights` represents the exact number of nights required** (not minimum nights - it must match exactly)
- [ ] **If promo has no night requirement**, either:
  - Omit the `total_nights` field entirely, OR
  - Set it to `null` or `undefined`
- [ ] **All existing required fields** (`id`, `name`, `code`, `description`, `hotel`) are still being sent correctly

## Questions for Backend Team

1. **Does the current `/promos/agent` endpoint include `total_nights` in the response?**
   - If YES: Please confirm the field name and data type
   - If NO: Can you add this field to the response?

2. **What does `total_nights` represent in your system?**
   - Is it the exact number of nights required (must match exactly)?
   - Or is it a minimum number of nights (must be >=)?
   - **Note**: Frontend currently validates for exact match. If your system uses minimum nights, we may need to adjust the validation logic.

3. **Are there any promos that don't have night requirements?**
   - If yes, how should we identify them? (omitted field, null value, etc.)

4. **Is there any other validation we should consider?**
   - Date range restrictions?
   - Hotel-specific restrictions?
   - Other eligibility criteria?

## Testing Recommendations

After implementing/verifying the payload:

1. **Test with promo that has `total_nights`**:
   - Select dates that match the required nights → Promo should be selectable
   - Select dates that don't match → Promo should be disabled

2. **Test with promo without `total_nights`**:
   - Promo should always be selectable regardless of stay duration

3. **Test edge cases**:
   - Single night stay with promo requiring 1 night
   - Long stay (7+ nights) with promo requiring specific nights
   - Promo with `total_nights: null` or `total_nights: undefined`

## Contact

If you have questions or need clarification on the frontend requirements, please reach out to the frontend team.

---

**Last Updated**: Based on frontend implementation date
**Frontend File**: `components/home/search-filter.tsx`
**Type Definition**: `app/(protected)/home/types.ts`

